<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>IMAP Bounce Dashboard</title>
  <link rel="stylesheet" href="/static/style.css">
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; background: #f7f9fc; color: #222; }
    header { background: #1e293b; color: #fff; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; }
    h1 { margin: 0; font-size: 1.5rem; }
    .btn { background: #3b82f6; color: #fff; padding: 0.5rem 1rem; border-radius: 4px; text-decoration: none; }
    .btn:hover { background: #2563eb; }
    main { padding: 2rem; }
    .card { background: #fff; border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 2rem; }
    .stat { font-size: 2rem; font-weight: bold; }
    .banner { background: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; padding: 1rem; border-radius: 6px; margin-bottom: 1.5rem; }
    .banner h2 { margin: 0 0 0.5rem 0; font-size: 1.2rem; }
    .banner ul { margin: 0; padding-left: 1.2rem; }
    table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 6px; overflow: hidden; }
    th, td { padding: 0.75rem 1rem; text-align: left; }
    th { background: #f1f5f9; font-weight: 600; }
    tr:nth-child(even) { background: #f9fafb; }
  </style>
</head>
<body>
  <header>
    <h1>IMAP Bounce Dashboard</h1>
    <a class="btn" href="/logout">Logout</a>
  </header>

  <main>
    {% if missing_vars and missing_vars|length > 0 %}
    <div class="banner">
      <h2>⚠️ Missing Configuration</h2>
      <p>The following environment variables are missing from <code>data/.env</code>:</p>
      <ul>
        {% for var in missing_vars %}
          <li>{{ var }}</li>
        {% endfor %}
      </ul>
      <p>Please update <code>data/.env</code> and restart the service.</p>
    </div>
    {% endif %}

    <div class="card">
      <h2>Total Bounces</h2>
      <div class="stat">{{ bounce_count }}</div>
    </div>

    <div class="card">
      <h2>Recent Logs</h2>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Date</th>
            <th>To</th>
            <th>Cc</th>
            <th>Status</th>
            <th>Reason</th>
            <th>Domain</th>
          </tr>
        </thead>
        <tbody id="logs-body">
          <!-- Populated via fetch -->
        </tbody>
      </table>
    </div>
  </main>

  <script>
    async function loadLogs() {
      const res = await fetch('/api/logs');
      if (!res.ok) return;
      const data = await res.json();
      const body = document.getElementById('logs-body');
      body.innerHTML = '';
      data.data.forEach(row => {
        body.innerHTML += `
          <tr>
            <td>${row.id || ''}</td>
            <td>${row.date || ''}</td>
            <td>${row.email_to || ''}</td>
            <td>${row.email_cc || ''}</td>
            <td>${row.status || ''}</td>
            <td>${row.reason || ''}</td>
            <td>${row.domain || ''}</td>
          </tr>`;
      });
    }
    loadLogs();
  </script>
</body>
</html>